/*! 版权归我所有 */
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/js/panel.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/js/panel.js":
/*!*************************!*\
  !*** ./src/js/panel.js ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("// chrome.storage.local.clear(function(aaa){console.log(aaa)})\nvar port = chrome.runtime.connect({ name: 'devtools' });\nlet mode = 'self'\n//定义一个全局变量来储存模式\n//切换按钮 点击事件：清空本次缓存, fetch新数据,更改provider文案\n//选中详情按钮 点击事件 ：填充html到provider ，  暂存html到缓存\n//点击provider区域  弹出html    点击parser 跳到sources\n//点击运行，直接执行parser\n\n$('#mode span').on('click', function () {\n    if (mode == 'self') {\n        $('#mode span').text('外校模式')\n        mode = 'else'\n        $('#provider_html').text('html')\n        port.postMessage({\n            name: 'mode',\n            mode: 'else',\n            tabId: chrome.devtools.inspectedWindow.tabId,\n\n        });\n    } else {\n        $('#mode span').text('本校模式')\n        mode = 'self'\n        $('#provider_html').text('provider')\n        port.postMessage({\n            name: 'mode',\n            mode: 'self',\n            tabId: chrome.devtools.inspectedWindow.tabId,\n\n        });\n\n    }\n    chrome.storage.local.set({ html: '' }, function (items1) {\n        chrome.storage.local.set({ current: '' }, function (items2) {\n            port.postMessage({\n                name: 'data',\n                tabId: chrome.devtools.inspectedWindow.tabId,\n                mode\n            });\n        })\n    })\n})\n\nchrome.storage.local.get({ noGuide: '' }, function (aaa) {\n    if (!aaa.noGuide) {\n        const driver = new Driver({\n            doneBtnText: '完成',\n            closeBtnText: '不再显示引导',            // Text on the close button for this step\n            stageBackground: '#ffffff',       // Background color for the staged behind highlighted element\n            opacity: 0.4,\n            allowClose: false,\n            nextBtnText: '下一步',              // Next button text for this step\n            prevBtnText: '上一步',\n        });\n        driver.defineSteps([\n            {\n                element: '#add',\n                popover: {\n                    className: 'first-step-popover-class',\n                    title: '1.新建',\n                    description: '点此新建学校',\n                    position: 'right'\n                }\n            },\n            {\n                element: '#bottom',\n                popover: {\n                    title: '2.列表',\n                    description: '此处显示您适配的教务系统列表',\n                    position: 'right'\n                }\n            },\n            {\n                element: '#upp',\n                popover: {\n                    title: '3.适配项',\n                    description: '点此切换适配项',\n                    position: 'bottom'\n                }\n            },\n            {\n                element: '#pre',\n                popover: {\n                    title: '4.函数',\n                    description: '点此此处开始编写函数',\n                    position: 'left'\n                }\n            },\n            {\n                element: '#shade',\n                popover: {\n                    title: '5.运行',\n                    description: '<--主页面处右键选择运行即可运行函数，上传即可上传函数',\n                    position: 'right'\n                }\n            },\n        ]);\n\n        // Start the introduction\n        driver.start();\n        $(document).on('click', '.driver-close-btn', function () {\n            console.log('nima')\n            chrome.storage.local.set({ noGuide: 1 }, function () {\n                console.log('不再显示引导');\n            });\n        })\n    }\n})\n\n// 与后台页面消息通信-长连接\n// chrome.devtools.network.onRequestFinished.addListener(function () {\n//    \n// })\nlet filter = ''\nlet modifyUrlSchoolInfo = ''\n//取数据放进去\n$('#bar').text(`Aischedule Devtools`)\nport.postMessage({\n    name: 'fetchMode',\n    tabId: chrome.devtools.inspectedWindow.tabId\n});\n\nsetInterval(function () {\n    try {\n        port.postMessage({\n            name: 'userId',\n            tabId: chrome.devtools.inspectedWindow.tabId\n        });\n    } catch (err) {\n        console.error(err)\n    }\n}, 1000)\nport.postMessage({\n    name: 'update',\n    tabId: chrome.devtools.inspectedWindow.tabId\n});\nrefreshCurrent()\n\n// 监听后台页面消息\nport.onMessage.addListener((message) => {\n    if (message.name == 'schools') {\n        $('.selectpicker').empty()\n        $('.selectpicker').append(\"<option value='请选择学校' style='display: none'>请选择学校</option>\");\n        message.msg.forEach(function (item,) {\n            $('.selectpicker').append(\"<option value=\" + item.school_name + \">\" + item.school_name + \"</option>\");\n        })\n\n        $('.selectpicker').selectpicker('refresh')\n        $('.selectpicker').selectpicker('render')\n    };\n    if (message.name == 'tbs') {\n        $('#bottom').empty()\n        chrome.storage.local.get({ current: '' }, function (items) {\n            console.log('message.myTbs')\n            console.log(message.myTbs)\n            refreshListAndLighting(message.myTbs, items.current, filter)\n        })\n    }\n    if (message.name == 'html') {\n        $('#pre').html(message.myTbs)\n        console.log(message.myTbs)\n        chrome.storage.local.set({ html: message.myTbs }, function (items) {\n        })\n    }\n    if (message.name == 'fetchMode') {\n        let currentMode = message.mode\n        if (currentMode == 'else') {\n            $('#mode span').text('外校模式')\n            mode = 'else'\n            $('#provider_html').text('html')\n            port.postMessage({\n                name: 'mode',\n                mode: 'else',\n                tabId: chrome.devtools.inspectedWindow.tabId,\n\n            });\n        } else {\n            $('#mode span').text('本校模式')\n            mode = 'self'\n            $('#provider_html').text('provider')\n            port.postMessage({\n                name: 'mode',\n                mode: 'self',\n                tabId: chrome.devtools.inspectedWindow.tabId,\n\n            });\n\n        }\n        chrome.storage.local.set({ html: '' }, function (items1) {\n            chrome.storage.local.set({ current: '' }, function (items2) {\n                port.postMessage({\n                    name: 'data',\n                    tabId: chrome.devtools.inspectedWindow.tabId,\n                    mode\n                });\n            })\n        })\n    }\n    if (message.name == 'newVersion') {\n        $('#update').css('display', 'flex')\n\n    }\n    if (message.name == 'userId') {\n        $('#login button').text(message.msg)\n        if (message.msg == 'login') { $('#login img').attr('src', '../img/icon_user_not_login.png') } else { $('#login img').attr('src', '../img/icon_user_login.png') }\n    }\n    if (message.name == 'onunload') {\n        console.log('onunload')\n        chrome.storage.local.get({ current: '' }, function (items) {\n            if (!items.current) {\n                return\n            }\n            chrome.devtools.inspectedWindow.getResources(function (Resources) {\n                for (let resource of Resources) {\n                    if (resource.url == chrome.runtime.getURL('/js/scheduleHtmlProvider.js')) {\n                        resource.setContent(items.current.provider_html)\n                    }\n                    if (resource.url == chrome.runtime.getURL('/js/scheduleHtmlParser.js')) {\n                        resource.setContent(items.current.parser)\n                    }\n                    // if (resource.url == chrome.runtime.getURL('/js/schoolUrl.js')) {\n                    //     resource.setContent(items.current.url)\n                    // }\n                }\n                chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlParser.js'), 1, function (aaa) { })\n                // chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/schoolUrl.js'), 1, function (aaa) { console.log(aaa) })\n                chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlProvider.js'), 1, function (aaa) { })\n\n            })\n        });\n    }\n})\n\n//事件监听\ndocument.getElementById('login').addEventListener('click', function () {\n    // 往后台页面发送消息\n    port.postMessage({\n        name: 'login',\n        tabId: chrome.devtools.inspectedWindow.tabId\n    });\n});\n\ndocument.getElementById('dragger').ondrag = function (a, b, c) {\n    if (a.pageX != 0 && a.pageX / document.body.clientWidth * 100 < 70) {\n        document.getElementById('left').style.flex = '0 0 ' + a.pageX / document.body.clientWidth * 100 + '%'\n    }\n}\n\ndocument.getElementById('inputEAS').addEventListener('keyup', function (value) {\n    let tmp = this.value\n    $('#inputEAS').css('box-shadow', '0 0  rgb(230, 56, 56)')\n\n    chrome.storage.local.set({ eas: tmp }, function () {\n        console.log('保存成功！!');\n    });\n});\ndocument.getElementById('inputURL').addEventListener('keyup', function (value) {\n    let tmp = this.value\n    $('#inputURL').css('box-shadow', '0 0 rgb(230, 56, 56)')\n\n    chrome.storage.local.set({ url: tmp }, function () {\n        console.log('保存成功！!');\n    });\n});\ndocument.getElementById('add').addEventListener('click', function (e) {\n    e.stopPropagation()\n    $('#modal').css('display', 'flex')\n});\ndocument.getElementById('cancel').addEventListener('click', function (e) {\n    e.stopPropagation()\n    $('#modal').css('display', 'none')\n    $('.selectpicker').selectpicker('val', ['noneSelectedText'])\n    $(\".selectpicker\").selectpicker('refresh')\n    $('#inputEAS').val('')\n    $('#inputURL').val('')\n    chrome.storage.local.set({ eas: '' }, function () { });\n    chrome.storage.local.set({ url: '' }, function () { });\n    chrome.storage.local.set({ school: '' }, function () { });\n    $('.bootstrap-select').css('box-shadow', '0 0  rgb(230, 56, 56)')\n    $('#inputURL').css('box-shadow', '0 0  rgb(230, 56, 56)')\n    $('#inputEAS').css('box-shadow', '0 0  rgb(230, 56, 56)')\n\n});\n// $(document).mouseup(function (e) {\n//     var _con = $('.modal');   // 设置目标区域\n//     if (!_con.is(e.target) && _con.has(e.target).length === 0) {\n//         $('.inputSchool').css('display', 'none')\n//         $('.selectpicker').selectpicker('val', ['noneSelectedText'])\n//         $(\".selectpicker\").selectpicker('refresh')\n//         $('#inputEAS').val('')\n//         $('#inputURL').val('')\n//     }\n// });\nlet b\n$('.top input').on('keyup', function (e) {\n    filter = e.target.value\n    clearTimeout(b)\n    b = setTimeout(function () {\n        port.postMessage({\n            name: 'data', mode,\n            tabId: chrome.devtools.inspectedWindow.tabId\n        });\n    }, 500)\n\n})\n$('.selectpicker').on('show.bs.select', function (e, clickedIndex, isSelected, previousValue) {\n    $('.bootstrap-select').css('box-shadow', '0 0 rgb(230, 56, 56)')\n\n    let a\n    $('.bs-searchbox').children('input').keyup(function (value) {\n        let tmp = this.value\n        if (tmp === '') {\n            tmp = '北京'\n        }\n        clearTimeout(a)\n        a = setTimeout(function () {\n            port.postMessage({\n                name: 'fetchSchool',\n                tabId: chrome.devtools.inspectedWindow.tabId,\n                msg: tmp\n            });\n        }, 500)\n    })\n});\n$('.selectpicker').on('changed.bs.select', function (e, clickedIndex, isSelected, previousValue) {\n    chrome.storage.local.set({ school: e.target.value }, function () {\n        console.log('保存学校成功：' + e.target.value);\n    });\n});\n$('#upp>button').on('click', function (e) {\n    $('#upp>button').css('border-bottom', '0px solid rgb(37, 159, 255)')\n    $('#upp>button').css(\"padding\", \"0px 20px 10px 20px;\")\n    $(`#${e.currentTarget.id}`).css('border-bottom', '3px solid rgb(37, 159, 255)')\n    console.log(e.currentTarget.id)\n    $(`#${e.currentTarget.id}`).css(\"padding\", \"0px 20px 7px 20px;\")\n    chrome.storage.local.get({ current: '' }, function (items) {\n        chrome.storage.local.get({ html: '' }, function (html) {\n            if (e.currentTarget.id == 'provider_html' && mode == 'else') {\n                $('#pre').html(html.html)\n\n            } else {\n\n                $('#pre').text(items.current[e.currentTarget.id] ? items.current[e.currentTarget.id] : '')\n            }\n        })\n    })\n})\n\n\n// 点击代码区,跳转sources\n$('#pre').on('click', function (a) {\n    if (window.getSelection().type == 'Range') {\n        return\n    }\n    //找到resources中的两个文件，找到存储中的两个函数，替换掉\n    chrome.storage.local.get({ current: '' }, function (items) {\n        chrome.devtools.inspectedWindow.getResources(function (Resources) {\n            for (let resource of Resources) {\n                if (resource.url == chrome.runtime.getURL('/js/scheduleHtmlProvider.js')) {\n                    resource.setContent(items.current.provider_html)\n                }\n                if (resource.url == chrome.runtime.getURL('/js/scheduleHtmlParser.js')) {\n                    resource.setContent(items.current.parser)\n                }\n                // if (resource.url == chrome.runtime.getURL('/js/schoolUrl.js')) {\n                //     resource.setContent(items.current.url)\n                // }\n            }\n            if (mode == 'else') {\n                chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlParser.js'), 1, function (aaa) { })\n\n                chrome.storage.local.get({ html: '' }, function (items) {\n                    win = window.open('', 'provider', 'scrollbars=yes,resizable=1,modal=false,alwaysRaised=yes');  //打开新的空白窗口\n                    win.document.write(`<body>${items.html}</body>`);\n                    win.document.close()\n                })\n\n            } else {\n\n                if ($('#parser').css('border-bottom') == '3px solid rgb(37, 159, 255)') {\n                    // if ($('#parser').css('border-bottom-style') == 'solid') {\n\n                    chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlProvider.js'), 1, function (aaa) { })\n                    // chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/schoolUrl.js'), 1, function (aaa) { console.log(aaa) })\n                    chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlParser.js'), 1, function (aaa) { })\n                } else {\n                    chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlParser.js'), 1, function (aaa) { })\n                    // chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/schoolUrl.js'), 1, function (aaa) { console.log(aaa) })\n                    chrome.devtools.panels.openResource(chrome.runtime.getURL('/js/scheduleHtmlProvider.js'), 1, function (aaa) { })\n\n                }\n            }\n        })\n    });\n\n\n\n});\n\n//开发者点击ctrl+s之后，替换掉对应学校本地存储中的代码\nchrome.devtools.inspectedWindow.onResourceContentCommitted.addListener(function (resource, content) {\n    //找到现在的学校，从resource.url中取到对应文件名，用content覆盖文件\n    chrome.storage.local.get({ current: '' }, function (items) {\n        if (!items.current) { console.log('请先新建学校'); return }\n        if (resource.url == chrome.runtime.getURL('/js/scheduleHtmlProvider.js')) {\n            items.current.provider_html = content\n        }\n        if (resource.url == chrome.runtime.getURL('/js/scheduleHtmlParser.js')) {\n            items.current.parser = content\n        }\n        chrome.storage.local.get({ html: '' }, function (html) {\n            items.current.html = html.html\n            chrome.storage.local.get({ [items.current.school.school_name + '-' + items.current.eas]: '' }, function (items1) {\n                console.log(items1)\n                if (items1[items.current.school.school_name + '-' + items.current.eas]) {\n                    chrome.storage.local.set({ [items.current.school.school_name + '-' + items.current.eas]: items.current })\n                    setCurrentAndRefreshFun({ school: items.current.school.school_name, eas: items.current.eas, url: items.current.url, provider_html: items.current.provider_html, parser: items.current.parser })\n                    port.postMessage({\n                        name: 'data', mode,\n                        tabId: chrome.devtools.inspectedWindow.tabId\n                    });\n                } else {\n                    addProject({ school: items.current.school.school_name, eas: items.current.eas, url: items.current.url, provider_html: items.current.provider_html, parser: items.current.parser })\n                    setCurrentAndRefreshFun({ school: items.current.school.school_name, eas: items.current.eas, url: items.current.url, provider_html: items.current.provider_html, parser: items.current.parser })\n                    port.postMessage({\n                        name: 'data', mode,\n                        tabId: chrome.devtools.inspectedWindow.tabId\n                    });\n                }\n            })\n        })\n    })\n})\n\n//开发者新建学校\ndocument.getElementById('confirm').addEventListener('click', function (a) {\n    chrome.storage.local.get({ school: '' }, function (items3) {\n        console.log(items3.school)\n        if (!items3.school) {\n            $('.bootstrap-select').css('box-shadow', '0 0 8px rgb(230, 56, 56)')\n            return\n        }\n        chrome.storage.local.get({ eas: '' }, function (items1) {\n            console.log(items1.eas)\n            if (!items1.eas) {\n                $('#inputEAS').css('box-shadow', '0 0 8px rgb(230, 56, 56)')\n                return\n            }\n            chrome.storage.local.get({ url: '' }, function (items2) {\n                console.log(items2.url)\n\n                if (!items2.url || ! /http(s)?:\\/\\/[\\w.]+[\\w\\/]*[\\w.]*\\??[\\w=&\\+\\%]*/is.test(items2.url)) {\n                    alert('url需完整格式，请检查是否丢失http://或者是否可访问')\n                    $('#inputURL').css('box-shadow', '0 0 8px rgb(230, 56, 56)')\n                    return\n                }\n                if (!items1.eas && !items2.url && !items3.school) {\n                    return\n                }\n                $('#modal').css('display', 'none')\n                chrome.storage.local.get({ [items3.school + '-' + items1.eas]: '' }, function (items) {\n                    if (items[items3.school + '-' + items1.eas]) {\n                        alert('您已创建过此学校')\n                    } else {\n                        let json = {\n                            school: items3.school, eas: items1.eas, url: items2.url,\n                            provider_html:\n                                `function scheduleHtmlProvider(iframeContent = \"\", frameContent = \"\", dom = document) {\n    //除函数名外都可编辑\n    //以下为示例，您可以完全重写或在此基础上更改\n                                \nconst ifrs = dom.getElementsByTagName(\"iframe\");\nconst frs = dom.getElementsByTagName(\"frame\");\n\nif (ifrs.length) {\n    for (let i = 0; i < ifrs.length; i++) {\n        const dom = ifrs[i].contentWindow.document;\n        iframeContent += scheduleHtmlProvider(iframeContent, frameContent, dom);\n        }\n} \nif (frs.length) {\n    for (let i = 0; i < frs.length; i++) {\n        const dom = frs[i].contentDocument.body.parentElement;\n        frameContent += scheduleHtmlProvider(iframeContent, frameContent, dom);\n        }\n} \nif(!ifrs.length && !frs.length){\n    return dom.querySelector('body').outerHTML\n}\nreturn dom.getElementsByTagName('html')[0].innerHTML + iframeContent+frameContent  \n}`,\n                            parser:\n                                `function scheduleHtmlParser(html) {\n    //除函数名外都可编辑\n    //传入的参数为上一步函数获取到的html\n    //可使用正则匹配\n    //可使用解析dom匹配，工具内置了$，跟jquery使用方法一样，直接用就可以了，参考：https://juejin.im/post/5ea131f76fb9a03c8122d6b9\n    //以下为示例，您可以完全重写或在此基础上更改\n    let result = []\n    let bbb = $('#table1 .timetable_con')\n    for (let u = 0; u < bbb.length; u++) {\n        let re = { sections: [], weeks: [] }\n        let aaa = $(bbb[u]).find('span')\n        let week = $(bbb[u]).parent('td')[0].attribs.id\n        if (week) {\n            re.day = week.split('-')[0]\n        }\n        for (let i = 0; i < aaa.length; i++) {\n\n            if (aaa[i].attribs.title == '上课地点') {\n\n                for (let j = 0; j < $(aaa[i]).next()[0].children.length; j++) {\n                    re.position = $(aaa[i]).next()[0].children[j].data\n                }\n            }\n            if (aaa[i].attribs.title == '节/周') {\n\n                for (let j = 0; j < $(aaa[i]).next()[0].children.length; j++) {\n\n                    let lesson = $(aaa[i]).next()[0].children[j].data\n                    for (let a = Number(lesson.split(')')[0].split('(')[1].split('-')[0]); a < Number(lesson.split(')')[0].split('(')[1].split('-')[1].split('节')[0]) + 1; a++) {\n\n                        re.sections.push({ section: a })\n                    }\n                    for (let a = Number(lesson.split(')')[1].split('-')[0]); a < Number(lesson.split(')')[1].split('-')[1].split('周')[0]) + 1; a++) {\n\n                        re.weeks.push(a)\n                    }\n                }\n            }\n\n            if (aaa[i].attribs.title == '教师') {\n\n                for (let j = 0; j < $(aaa[i]).next()[0].children.length; j++) {\n                    re.teacher = $(aaa[i]).next()[0].children[j].data\n                }\n            }\n\n            if (aaa[i].attribs.class == 'title') {\n\n                for (let j = 0; j < $(aaa[i]).children()[0].children.length; j++) {\n                    re.name = $(aaa[i]).children()[0].children[j].data\n\n                }\n            }\n\n        }\n        result.push(re)\n    }\n    console.log(result)\n\n    return { courseInfos: result }\n}`\n                        }\n                        addProject(json)\n                        port.postMessage({\n                            name: 'data', mode,\n                            tabId: chrome.devtools.inspectedWindow.tabId\n                        });\n                        setCurrentAndRefreshFun(json)\n                        chrome.storage.local.set({ school: '' }, function () {\n                            chrome.storage.local.set({ eas: '' }, function () {\n                                chrome.storage.local.set({ url: '' }, function () {\n                                });\n                                $('.selectpicker').selectpicker('val', ['noneSelectedText'])\n                                $(\".selectpicker\").selectpicker('refresh')\n                                $('#inputEAS').val('')\n                                $('#inputURL').val('')\n                            });\n                        });\n                    }\n                })\n            });\n        });\n    });\n});\n\nfunction addProject({ school = '', eas = '', url = '', provider_html = '', parser = '', updatedAt = Date.now(), id = `本地` }) {\n\n    let json = {\n        school: {\n            school_name: school\n        },\n        id,\n        updatedAt,\n        eas: eas,\n        url: url, provider_html, parser\n    }\n    chrome.storage.local.get({ list: [] }, function (items) {\n        items.list.push(school + '-' + eas)\n        chrome.storage.local.set({ list: items.list }, function () {\n            chrome.storage.local.set({ [school + '-' + eas]: json }, function () {\n\n            });\n        });\n    })\n}\n\nfunction setCurrentAndRefreshFun({ school = '', eas = '', url = '', provider_html = '', parser = '', updatedAt = Date.now(), id = `本地` }) {\n    $('.detail').css('background-color', 'rgba(0,12,23,1)')\n    $(`#d-${id}`).css('background-color', 'rgba(20,50,83,1)')\n    let json = {\n        school: {\n            school_name: school\n        },\n        id,\n        updatedAt,\n        eas: eas,\n        url: url, provider_html, parser\n    }\n    chrome.storage.local.set({ 'current': json }, function () {\n        console.log('保存成功！!');\n    });\n    $('.fun pre').text(provider_html)\n    $('#version').text(`版本号: ${id}   `)\n    $('#date').text('日期：' + new Date(updatedAt).getFullYear() + '/' + (new Date(updatedAt).getMonth() + 1) + '/' + new Date(updatedAt).getDate())\n}\n\nfunction refreshListAndLighting(items, lighting, filter) {\n    let stats = [\"E2E自测\", \"审核中\", \"内测中\", \"已上线\", '未通过', '离线任务']\n    let color = [\"gray\", 'yellow', 'blue', 'green', 'red']\n    chrome.storage.local.get({ list: [] }, function (list) {\n        let j = 0\n        let tmp = []\n        items.forEach(function (item) {\n            tmp.push(item.school.school_name + '-' + item.eas)\n        })\n        list.list.forEach(function (i) {\n            chrome.storage.local.get({ [i]: '' }, function (school_info) {\n                tmp.indexOf(i) > -1 ? items.push(school_info[i]) : {}\n\n                j++\n                if (j == list.list.length) {\n                    renderList(items)\n                }\n            })\n        })\n        if (list.list.length == 0) {\n            renderList(items)\n        }\n        function renderList(items) {\n\n            let aaa = {}\n            items.forEach(function (item) {\n                if (!filter || new RegExp(filter, 'gi').test(item.school.school_name)) {\n                    if (aaa[item.school.school_name + item.eas]) {\n                        aaa[item.school.school_name + item.eas].push(item)\n                    }\n                    else {\n                        aaa[item.school.school_name + item.eas] = []\n                        aaa[item.school.school_name + item.eas].push(item)\n\n                    }\n                }\n\n            })\n            filter = null\n            Object.keys(aaa).forEach(function (a) {\n                let str = ''\n                let hehe = 0\n                aaa[a].forEach(function (item) {\n                    if (lighting && lighting.school && lighting.school.school_name == item.school.school_name && lighting.eas == item.eas) { hehe = 1 }\n                    str += `<div class='detail ${item.school.school_name + item.eas}' id= 'd-${item.school.school_name + item.eas + item.id}' style='${lighting && lighting.school && lighting.school.school_name == item.school.school_name && lighting.eas == item.eas ? (lighting.id == item.id ? 'display:flex; background: #143253;color: #FFFFFF;' : 'display:flex;color:rgba(255,255,255,0.65);') : 'display:none ;'}cursor: pointer; flex-direction : row;justify-content: space-between;margin-bottom:2px;height:2.86rem;padding-left:2.57rem;font-size: 10px;flex:none'>\n                                 <div class='item' style:'font-size: 10px;'>${item.id ? item.id : '本地'}版本</div>\n                                 <div style='width:0.43rem;height:0.43rem;background:white;border-radius:0.43rem;margin-right:0.57rem;background-color:${color[item.status] ? color[item.status] : 'white'}'></div>\n                            \n                                 <div style='margin-right:1.14rem;font-size: 10px;width:5rem;'>${stats[item.status] ? stats[item.status] : '待开发'}</div>\n                             </div>`})\n                $('#bottom').append(`<div class='summary' id = ${aaa[a][0].school.school_name + aaa[a][0].eas} style='${hehe ? 'color: rgba(255,255,255,1);' : 'color: rgba(255,255,255,0.65);'}cursor: pointer;background: #001529;font-size: 13px;flex:none;line-height: 22px;justify-content:space-between;'>\n                    <span style='padding-left:1.71rem'> ${aaa[a][0].school.school_name}-${aaa[a][0].eas}</span>\n                    <img src=${hehe ? \"../img/icon_unfold.png\" : \"../img/icon_fold.png\"} alt=\"\" style='height:1rem;width:1rem;margin-right:1.21rem'>\n                </div>\n                ${str}`)\n            })\n\n            $('.summary').on('click', function (a, b, c) {\n                if ($('.' + a.currentTarget.id).css('display') == 'none') {\n                    $('.' + a.currentTarget.id).css('display', 'flex')\n                    $(a.currentTarget).css('color', 'rgba(255,255,255,1)')\n                    a.currentTarget.children[1].src = '../img/icon_unfold.png'\n                } else {\n                    $(a.currentTarget).css('color', 'rgba(255,255,255,0.65)')\n                    $('.' + a.currentTarget.id).css('display', 'none')\n                    a.currentTarget.children[1].src = '../img/icon_fold.png'\n                }\n\n                $('pre').hide()\n                $('#URL').show()\n                //找出本地项目URL 填充到输入框\n                console.log($(a.currentTarget).text().trim())\n                chrome.storage.local.get({ [$(a.currentTarget).text().trim()]: '' }, function (school_info) {\n                    console.log(school_info)\n                    modifyUrlSchoolInfo = $(a.currentTarget).text().trim()\n                    $('#URL>input').val(school_info[$(a.currentTarget).text().trim()].url)\n                })\n\n\n\n            })\n            $('.detail').on('click', function (a, b, c) {\n                $('.detail').css('background-color', 'rgba(0,12,23,1)')\n                $('.detail').css('color', 'rgba(255,255,255,0.65)')\n                $('#' + a.currentTarget.id).css('background-color', 'rgba(20,50,83,1)')\n                $('#' + a.currentTarget.id).css('color', 'rgba(255,255,255,1)')\n                $('pre').show()\n                $('#URL').hide()\n                //请求html并设置html\n\n                items.forEach(function (aaa) {\n                    if ('d-' + aaa.school.school_name + aaa.eas + aaa.id == a.currentTarget.id) {\n                        if (mode != 'self' && aaa.id != '本地') {\n\n                            port.postMessage({\n                                name: 'html',\n                                tabId: chrome.devtools.inspectedWindow.tabId,\n                                id: aaa.id\n                            });\n                        } else if (mode != 'self' && aaa.id == '本地') {\n                            console.log(aaa)\n                            $('#pre').html(aaa.html)\n                            chrome.storage.local.set({ html: aaa.html }, function (items) {\n                            })\n                        }\n                        chrome.storage.local.set({ 'current': aaa }, function () {\n                            refreshCurrent(aaa.id)\n                        });\n                    }\n                })\n            })\n            refreshCurrent()\n        }\n    })\n}\n$('#upload').on('click', function () {\n    port.postMessage({\n        name: 'upload',\n        tabId: chrome.devtools.inspectedWindow.tabId\n    });\n})\n$('#URL>input').on('keyup', function (e) {\n    // 改本地 如果current和现在一致就把current也改了\n    chrome.storage.local.get({ [modifyUrlSchoolInfo]: '' }, function (school_info) {\n        school_info[modifyUrlSchoolInfo].url = e.target.value\n        chrome.storage.local.set({ [modifyUrlSchoolInfo]: school_info[modifyUrlSchoolInfo] }, function () {\n            chrome.storage.local.get({ current: '' }, function (current) {\n                if ((current.current.school.school_name + '-' + current.current.eas) == modifyUrlSchoolInfo) {\n                    current.current.url = e.target.value\n                    chrome.storage.local.set({ current: current.current }, function () {\n                    })\n                }\n            });\n        })\n    })\n})\nfunction refreshCurrent(id) {\n\n    chrome.storage.local.get({ current: '' }, function (items) {\n        chrome.storage.local.get({ html: '' }, function (html) {\n\n            if (mode == 'self') {\n\n                $('#pre').text(items.current.provider_html ? items.current.provider_html : '')\n            } else {\n                if (id != '本地') {\n\n                    $('#pre').html(html.html)\n                } else {\n                    $('#pre').html(items.current.html)\n\n                }\n\n            }\n            $('#version').html('版本号：' + (items.current.id ? items.current.id : '本地') + '&nbsp;&nbsp;&nbsp;')\n            $('#date').text('日期：' + (items.current ? new Date(items.current.updatedAt).getFullYear() : new Date().getFullYear()) + '/' + ((items.current ? new Date(items.current.updatedAt).getMonth() + 1 : new Date().getMonth() + 1)) + '/' + (items.current ? new Date(items.current.updatedAt).getDate() : new Date().getDate()))\n            $('#upp>button').css('border-bottom', '0px solid rgb(37, 159, 255)')\n            $(`#provider_html`).css('border-bottom', '3px solid rgb(37, 159, 255)')\n            $(`#provider_html`).css(\"padding\", \"0px 20px 7px 20px\")\n        })\n    })\n\n}\n\n\n\n//# sourceURL=webpack:///./src/js/panel.js?");

/***/ })

/******/ });